<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/output.css">
    <title>Caesura</title>
    <script src="https://unpkg.com/htmx.org@{{ .Dependencies.HtmxVersion }}/dist/htmx.min.js"></script>
</head>

<body class="bg-gray-100">
    {{ template "header" . }}
    <!-- Page Content Placeholder -->
    <div id="page-content" class="flex pt-16">
        <div class="flex-col w-2/3">
            <div class="max-w-md mx-auto mt-8 mb-6 p-4 bg-gray-50 rounded-md shadow-sm">
                <label for="existing-orgs" class="block mb-2 text-sm font-medium text-gray-700">
                    Select Existing Organization:
                </label>
                <select id="existing-orgs" name="existing_org"
                    class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    hx-get="/organizations/active/session" hx-trigger="change" hx-swap="none"
                    hx-on::after-request="htmx.ajax('GET', '/session/active-organization/name', {target: '#active-organization', swap: 'innerHTML'})"
                    >
                </select>
                <button id="invite-button" type="button" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md"
                    hx-on::401="alert('Unauthorized')"
                    onclick="generateInvite()">
                    Invite
                </button>
                <button id="delete-btn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md ml-2"
                    hx-delete="/organizations" hx-swap="none"
                    hx-on::after-request="htmx.ajax('GET', '/organizations/options', {target: '#existing-orgs', swap: 'innerHTML'});
                        htmx.ajax('GET', '/session/active-organization/name', {target: '#active-organization', swap: 'innerHTML'})"
                    hx-on::401="alert('Unauthorized')"
                    hx-confirm="Are you sure you want to delete the organization?"
                    >
                    Delete
                </button>
                <!-- Hidden element just to fasilitate load organization -->
                <div hx-get="/organizations/options" hx-trigger="load" hx-target="#existing-orgs" hx-swap="innerHTML"
                    class="hidden"></div>
            </div>
            <div id="new-org" class="flex pt-16">
                <form class="max-w-md mx-auto p-6 bg-white rounded-md shadow-md" hx-post="/organizations" hx-swap="none"
                    hx-on::after-request="htmx.ajax('GET', '/organizations/options', {target: '#existing-orgs', swap: 'innerHTML'});
                        htmx.ajax('GET', '/session/active-organization/name', {target: '#active-organization', swap: 'innerHTML'})">
                    <h2 class="text-2xl font-semibold mb-6 text-gray-800">New Organization</h2>

                    <label for="name" class="block mb-2 text-sm font-medium text-gray-700">Name:</label>
                    <input type="text" id="name" name="name" placeholder="Enter organization name"
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        required />

                    <button type="submit" id="create-btn"
                        class="mt-6 w-full bg-blue-600 text-white font-semibold py-2 rounded-md hover:bg-blue-700 transition-colors">
                        Create
                    </button>
                </form>
            </div>
        </div>
        <div class="bg-white text-gray-600 text-sm rounded-lg p-4 shadow-md w-1/3">
            <p class="font-semibold text-gray-700">üí° Need help?</p>
            <p class="mb-4">
                Select an existing organization you want to work on, or create a new one below. After making your
                selection, you can navigate to other pages,
                and any actions you perform will be associated with the chosen organization.
            </p>
            <p class="font-semibold text-gray-700">üë• Invite others?</p>
            <p>
                As an administrator, you can invite others to your organization by clicking the <i>Invite</i> button.
                This generates a shareable link that grants <strong>read-only access</strong> to your organization's
                content.
            </p>
            <p class="mb-4">
                The link is valid for <strong>48 hours</strong> from the time of creation.
            </p>

            <p class="font-semibold text-gray-700">üîó Join an existing organization?</p>
            <p class="mb-4">
                To join, please contact an administrator of that organization and ask them to invite you using the
                invite link.
            </p>

            <p class="font-semibold text-gray-700 mb-2">‚ú® Create new?</p>
            <p class="mb-4">
                Write the name and hit the <i>Create</i> button. You will automatically be assigned as the administrator
                of the new organization.
            </p>

            <p class="font-semibold text-gray-700">üóëÔ∏è Deletion</p>
            <p>
                Deleting an organization does not remove any data immediately. The organization is simply flagged as
                <strong>inactive</strong>.
            </p>
            <p class="mb-2">
                If you accidentally delete an organization, please <strong>contact us</strong> and we will help you
                restore it.
            </p>
            <p class="mb-4">
                <strong>Note:</strong> If an organization remains in the deleted state for a long time, your data may
                eventually be permanently deleted.
            </p>

            <p class="font-semibold text-gray-700">‚è≥ Expired subscriptions</p>
            <p>
                Data is not deleted immediately when a subscription expires. However, if the organization does not renew
                its subscription,
                the data may eventually be permanently deleted. In any case, we will make attempts to notify
                administrators via their registered email addresses before performing irreversible actions.
            </p>
        </div>
    </div>
    <script>
        function generateInvite() {
            const select = document.getElementById("existing-orgs")
            if (select.options.length === 0) {
                alert("No available organizations")
                return
            }

            const id = select.options[0].value
            fetch(`/organizations/${id}/invite`)
                .then(res => res.json())
                .then(data => {
                    const link = data.invite_link;
                    if (!link) {
                        alert("No invite_link in response")
                    }
                    navigator.clipboard.writeText(link).then(() => {
                        console.log("Clipboard write succeeded");
                        alert("Invite link copied to clipboard!");
                    });
                })
        }
    </script>
</body>
